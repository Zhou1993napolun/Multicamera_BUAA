**多任务训练考虑以下方案**

同时刻的多组视角的图片视为一个输入

（可选）在输入时针对图片视角设计encoder

1. 使用单个模型作为框架，每组更新
2. 使用多个模型作为框架，每个视角对应更新一个模型
3. 使用1.x个模型作为框架，模型中选择某一部分，拆出来，每个视角对应训练该部分，对后续输出进行加权或门控组合


**MMoE方法**

由于每个模型对应各自独立的特征抽取网络和特征映射到pid的head，考虑以下方法：

1. 在映射完之后，计算loss之前的最后一步，获取one hot向量的值，使用专家门控和权重组合one hot向量结果再和target做损失（共享target），然后freeze非专家以为的部分，只更新专家门控。这种方法训练速度应该会相对较快，但仍然会有MMoE不易收敛的现象
2. 抽取完特征之后，就对特征进行专家门控和加权组合，之后得到的特征统一过一个全新的特征抽取层（重新训练的），freeze特征抽取部分，更新后续部分。应该会较难训练，需要较多的轮次和尝试

训练过程冲，考虑对训练样本设置一个scale。对于某一时刻，如果摄像头的视角不全，对于最终的feature，各个存在的视角都乘以一个total/(total-missing)用以使得最终的均值不变。

**训练损失**

位置

/data01/zhangleiting/_codes/fast-reid/fastreid/modeling/meta_arch/mgn.py

细节：

mgn是多尺度特征融合，可以将其看做mtl的多个不同任务的输出，输出完之后再进行concat等操作融合为一个整体，反向传播进行门控部分的更新


考虑新的策略：在某一视角输入图片不存在时，可以考虑输入一个全黑的图片，这样可以尝试增加batch

**文件命名细节**

后缀带有dup以及copy的文件和原文件内容一样，目的是在使用bash批量操作的时候使用不同文件夹下的权重，不引起冲突

后缀带有partial的文件，目的是进行少视角的重新训练

后缀带有p的文件，只用于原模型在少视角下的测试